!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?exports["@tomasc/recurring-select"]=e(require("jquery")):t["@tomasc/recurring-select"]=e(t.jquery)}(window,function(t){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=4)}([function(t,e,i){"use strict";(function(t){e.a=class{static register(){var t,e,i,s;return this,e=(t=null!=(i=this.defaults)?i:{}).name||(t.name=/function ([^(]*)/.exec(this+"")[1]),Array.prototype.slice.call(arguments).slice(1),null!=(s=arguments[0])?s:this.selector,this.init_plugin(this,e)}static init_plugin(e,i){if(void 0===t.fn[i])return t.fn[i]=function(t){var s,n,r;return s=arguments,n=`plugin_${i}`,void 0===t||"object"==typeof t?this.each(function(){var i;if(this.pluginInstances||(this.pluginInstances={}),!this.pluginInstances[n])return i=new e(this,t),this.pluginInstances[n]=i}):"string"==typeof t&&"_"!==t[0]&&"init"!==t?(r=void 0,this.each(function(){var i;if(this.pluginInstances||(this.pluginInstances={}),(i=this.pluginInstances[n])instanceof e&&"function"==typeof i[t]&&(r=i[t].apply(i,Array.prototype.slice.call(s,1))),"destroy"===t)return this.pluginInstances[n]=null}),void 0!==r?r:this):void 0}}constructor(e,i){this.element=e,this.options=t.extend({},this.constructor.defaults,i),this.$element=t(this.element),this.init()}}}).call(this,i(1))},function(e,i){e.exports=t},function(t,e,i){"use strict";(function(t){var s=i(3),n=i(0);e.a=function(){class e extends n.a{init(){}destroy(){return this.dialog_instance&&this.dialog_instance.destroy(),this.dialog_instance=void 0}get_data(t){return this.$element.data(t)}set_initial_values(){return this.$element.data("initial-value-hash",this.$element.val()),this.$element.data("initial-value-str",t(this.$element.find("option").get()[this.$element.prop("selectedIndex")]).text())}changed(){return"custom"===this.$element.val()?this.open_custom():this.set_initial_values()}open_custom(){return this.$element.data("recurring-select-active",!0),this.dialog_instance=new s.a(this.element,{input_instance:this}),this.$element.blur()}save(e){var i;return this.$element.find("option[data-custom]").remove(),i=JSON.stringify(e.hash),-1===t.inArray(i,this.$element.find("option").map(function(e){return t(this).val()}))&&this.insert_option(e.str,i),this.$element.val(i),this.set_initial_values(),this.$element.trigger("recurring_select:save")}current_rule(){return{str:this.$element.data("initial-value-str"),hash:t.parseJSON(this.$element.data("initial-value-hash"))}}cancel(){return this.$element.val(this.$element.data("initial-value-hash")),this.$element.data("recurring-select-active",!1),this.$element.trigger("recurring_select:cancel")}insert_option(e,i){var s,n;return 0===(n=this.$element.find("option:disabled")).length&&(n=this.$element.find("option")),n=n.last(),(s=t(document.createElement("option"))).attr("data-custom",!0),"*"!==e.substr(e.length-1)&&(e+="*"),s.text(e),s.val(i),s.insertBefore(n)}}return e.defaults={debug:!1},e}()}).call(this,i(1))},function(t,e,i){"use strict";(function(t){var s=i(0),n=function(t,e){if(!(t instanceof e))throw new Error("Bound instance method accessed before binding")};e.a=function(){class e extends s.a{constructor(){super(...arguments),this.positionDialogVert=this.positionDialogVert.bind(this),this.cancel=this.cancel.bind(this),this.outerCancel=this.outerCancel.bind(this),this.save=this.save.bind(this),this.summaryUpdate=this.summaryUpdate.bind(this),this.summaryFetchSuccess=this.summaryFetchSuccess.bind(this),this.init_calendar_days=this.init_calendar_days.bind(this),this.init_calendar_weeks=this.init_calendar_weeks.bind(this),this.toggle_month_view=this.toggle_month_view.bind(this),this.freqChanged=this.freqChanged.bind(this),this.intervalChanged=this.intervalChanged.bind(this),this.daysChanged=this.daysChanged.bind(this),this.dateOfMonthChanged=this.dateOfMonthChanged.bind(this),this.weekOfMonthChanged=this.weekOfMonthChanged.bind(this)}init(){return this.current_rule=this.options.input_instance.current_rule(),this.position=this.options.input_instance.get_data("recurring-select-position"),this.initDialogBox(),null==this.current_rule.hash||null==this.current_rule.hash.rule_type?this.freqChanged():"inline"!==this.position?setTimeout(this.positionDialogVert,10):void 0}destroy(){}initDialogBox(){var e;return t(".rs_dialog_holder").remove(),e="inline"===this.position?this.$element.parent():t("body"),t(".ui-page-active").length&&(e=t(".ui-page-active")),e.append(this.template()),this.outer_holder=t(".rs_dialog_holder"),this.outer_holder.addClass(this.position),this.inner_holder=this.outer_holder.find(".rs_dialog"),this.content=this.outer_holder.find(".rs_dialog_content"),"inline"!==this.position&&this.positionDialogVert(!0),this.mainEventInit(),this.freqInit(),this.summaryInit(),this.outer_holder.trigger("recurring_select:dialog_opened"),this.freq_select.focus()}positionDialogVert(i){var s,r,a,l;return n(this,e),l=t(window).height(),t(window).width(),(s=this.content.outerHeight())<80&&(s=80),(r=(l-s)/2-30)<10&&(r=10),a={"margin-top":r+"px","min-height":s+"px"},null!=i?(this.inner_holder.css(a),this.inner_holder.trigger("recurring_select:dialog_positioned")):(this.inner_holder.addClass("animated"),this.inner_holder.animate(a,200,()=>(this.inner_holder.removeClass("animated"),this.content.css({width:"auto"}),this.inner_holder.trigger("recurring_select:dialog_positioned"))))}cancel(i){return n(this,e),i&&i.preventDefault(),this.outer_holder.remove(),this.options.input_instance.cancel(),t("body").off("click.recurring_select_cancel")}outerCancel(i){if(n(this,e),t(i.target).hasClass("rs_dialog_holder"))return this.cancel()}save(){if(n(this,e),null!=this.current_rule.str)return this.outer_holder.remove(),this.options.input_instance.save(this.current_rule),t("body").off("click.recurring_select_cancel")}mainEventInit(){return this.outer_holder.on("click",this.outerCancel.bind(this)),this.content.on("click","h1 a",this.cancel.bind(this)),this.save_button=this.content.find("input.rs_save").on("click",this.save.bind(this)),this.content.find("input.rs_cancel").on("click",this.cancel.bind(this))}freqInit(){var t;return this.freq_select=this.outer_holder.find(".rs_frequency"),null!=this.current_rule.hash&&null!=(t=this.current_rule.hash.rule_type)&&(-1!==t.search(/Weekly/)?(this.freq_select.prop("selectedIndex",1),this.initWeeklyOptions()):-1!==t.search(/Monthly/)?(this.freq_select.prop("selectedIndex",2),this.initMonthlyOptions()):-1!==t.search(/Yearly/)?(this.freq_select.prop("selectedIndex",3),this.initYearlyOptions()):this.initDailyOptions()),this.freq_select.on("change",this.freqChanged.bind(this))}initDailyOptions(){var t,e;return(t=(e=this.content.find(".daily_options")).find(".rs_daily_interval")).val(this.current_rule.hash.interval),t.on("change keyup",this.intervalChanged.bind(this)),e.show()}initWeeklyOptions(){var e,i;return(e=(i=this.content.find(".weekly_options")).find(".rs_weekly_interval")).val(this.current_rule.hash.interval),e.on("change keyup",this.intervalChanged.bind(this)),i.find(".day_holder a").each(function(e,i){return t(i).removeClass("selected")}),null!=this.current_rule.hash.validations&&null!=this.current_rule.hash.validations.day&&t(this.current_rule.hash.validations.day).each(function(t,e){return i.find(".day_holder a[data-value='"+e+"']").addClass("selected")}),i.off("click",".day_holder a").on("click",".day_holder a",this.daysChanged.bind(this)),i.show()}initMonthlyOptions(){var t,e,i,s,n,r;return(n=(r=this.content.find(".monthly_options")).find(".rs_monthly_interval")).val(this.current_rule.hash.interval),n.on("change keyup",this.intervalChanged.bind(this)),(t=this.current_rule.hash).validations||(t.validations={}),(e=this.current_rule.hash.validations).day_of_month||(e.day_of_month=[]),(i=this.current_rule.hash.validations).day_of_week||(i.day_of_week={}),this.init_calendar_days(r),this.init_calendar_weeks(r),s=Object.keys(this.current_rule.hash.validations.day_of_week).length>0,r.find(".monthly_rule_type_week").prop("checked",s),r.find(".monthly_rule_type_day").prop("checked",!s),this.toggle_month_view(),r.find("input[name=monthly_rule_type]").on("change",this.toggle_month_view.bind(this)),r.show()}initYearlyOptions(){var t,e;return(t=(e=this.content.find(".yearly_options")).find(".rs_yearly_interval")).val(this.current_rule.hash.interval),t.on("change keyup",this.intervalChanged.bind(this)),e.show()}summaryInit(){return this.summary=this.outer_holder.find(".rs_summary"),this.summaryUpdate()}summaryUpdate(t){var i;return n(this,e),this.summary.width(this.content.width()),null!=this.current_rule.hash&&null!=this.current_rule.str?(this.summary.removeClass("fetching"),this.save_button.removeClass("disabled"),(i=this.current_rule.str.replace("*","")).length<20&&(i=`${this.options.texts.summary}: `+i),this.summary.find("span").html(i)):(this.summary.addClass("fetching"),this.save_button.addClass("disabled"),this.summary.find("span").html(""),this.summaryFetch())}summaryFetch(){if(null!=this.current_rule.hash&&null!=this.current_rule.hash.rule_type)return this.current_rule.hash.week_start=this.options.texts.first_day_of_week,t.ajax({url:`/recurring_select/translate/${this.options.texts.locale_iso_code}`,type:"POST",data:this.current_rule.hash,success:this.summaryFetchSuccess})}summaryFetchSuccess(t){return n(this,e),this.current_rule.str=t,this.summaryUpdate(),this.content.css({width:"auto"})}init_calendar_days(i){var s,r,a,l,h;for(n(this,e),(l=i.find(".rs_calendar_day")).html(""),h=a=1;a<=31;h=++a)l.append(s=t(document.createElement("a")).text(h)),-1!==t.inArray(h,this.current_rule.hash.validations.day_of_month)&&s.addClass("selected");return l.append(r=t(document.createElement("a")).text(this.options.texts.last_day)),r.addClass("end_of_month"),-1!==t.inArray(-1,this.current_rule.hash.validations.day_of_month)&&r.addClass("selected"),l.find("a").on("click",this.dateOfMonthChanged.bind(this))}init_calendar_weeks(i){var s,r,a,l,h,o,u,c,d,_,p,y,f,m;for(n(this,e),(c=i.find(".rs_calendar_week")).html(""),f=this.options.texts.order,m=this.options.monthly.show_week,s=this.options.texts.days_first_letter,h=l=0,u=(_=[1,2,3,4,5,-1]).length;l<u;h=++l)if(d=_[h],m[h])for(c.append(`<span>${f[d-1]}</span>`),a=o=p=this.options.texts.first_day_of_week,y=7+this.options.texts.first_day_of_week;p<=y?o<y:o>y;a=p<=y?++o:--o)(r=t("<a>",{text:s[a%=7]})).attr("day",a),r.attr("instance",d),c.append(r);return t.each(this.current_rule.hash.validations.day_of_week,function(e,s){return t.each(s,function(t,s){return i.find(`a[day='${e}'][instance='${s}']`).addClass("selected")})}),c.find("a").on("click",this.weekOfMonthChanged.bind(this))}toggle_month_view(){var t;return n(this,e),t=this.content.find(".monthly_rule_type_week").prop("checked"),this.content.find(".rs_calendar_week").toggle(t),this.content.find(".rs_calendar_day").toggle(!t)}freqChanged(){var i;switch(n(this,e),t.isPlainObject(this.current_rule.hash)||(this.current_rule.hash=null),(i=this.current_rule).hash||(i.hash={}),this.current_rule.hash.interval=1,this.current_rule.hash.until=null,this.current_rule.hash.count=null,this.current_rule.hash.validations=null,this.content.find(".freq_option_section").hide(),this.content.find("input[type=radio], input[type=checkbox]").prop("checked",!1),this.freq_select.val()){case"Weekly":this.current_rule.hash.rule_type="IceCube::WeeklyRule",this.current_rule.str=this.options.texts.weekly,this.initWeeklyOptions();break;case"Monthly":this.current_rule.hash.rule_type="IceCube::MonthlyRule",this.current_rule.str=this.options.texts.monthly,this.initMonthlyOptions();break;case"Yearly":this.current_rule.hash.rule_type="IceCube::YearlyRule",this.current_rule.str=this.options.texts.yearly,this.initYearlyOptions();break;default:this.current_rule.hash.rule_type="IceCube::DailyRule",this.current_rule.str=this.options.texts.daily,this.initDailyOptions()}if(this.summaryUpdate(),"inline"!==this.position)return this.positionDialogVert()}intervalChanged(i){var s;return n(this,e),this.current_rule.str=null,(s=this.current_rule).hash||(s.hash={}),this.current_rule.hash.interval=parseInt(t(i.currentTarget).val()),(this.current_rule.hash.interval<1||isNaN(this.current_rule.hash.interval))&&(this.current_rule.hash.interval=1),this.summaryUpdate()}daysChanged(i){var s,r;return n(this,e),t(i.currentTarget).toggleClass("selected"),this.current_rule.str=null,(s=this.current_rule).hash||(s.hash={}),this.current_rule.hash.validations={},r=this.content.find(".day_holder a.selected").map(function(){return parseInt(t(this).data("value"))}),this.current_rule.hash.validations.day=r.get(),this.summaryUpdate(),!1}dateOfMonthChanged(i){var s,r,a;return n(this,e),t(i.currentTarget).toggleClass("selected"),this.current_rule.str=null,(s=this.current_rule).hash||(s.hash={}),this.current_rule.hash.validations={},r=this.options.texts.last_day,a=this.content.find(".monthly_options .rs_calendar_day a.selected").map(function(){return t(this).text()===r?-1:parseInt(t(this).text())}),this.current_rule.hash.validations.day_of_week={},this.current_rule.hash.validations.day_of_month=a.get(),this.summaryUpdate(),!1}weekOfMonthChanged(i){var s;return n(this,e),t(i.currentTarget).toggleClass("selected"),this.current_rule.str=null,(s=this.current_rule).hash||(s.hash={}),this.current_rule.hash.validations={},this.current_rule.hash.validations.day_of_month=[],this.current_rule.hash.validations.day_of_week={},this.content.find(".monthly_options .rs_calendar_week a.selected").each((e,i)=>{var s,n,r;return n=parseInt(t(i).attr("day")),r=parseInt(t(i).attr("instance")),(s=this.current_rule.hash.validations.day_of_week)[n]||(s[n]=[]),this.current_rule.hash.validations.day_of_week[n].push(r)}),this.summaryUpdate(),!1}template(){var t,e,i,s,n;for(n=`<div class='rs_dialog_holder'> <div class='rs_dialog'> <div class='rs_dialog_content'> <h1>${this.options.texts.repeat} <a href='#' title='${this.options.texts.cancel}' Alt='${this.options.texts.cancel}'></a> </h1> <p class='frequency-select-wrapper'> <label for='rs_frequency'>${this.options.texts.frequency}:</label> <select data-wrapper-class='ui-recurring-select' id='rs_frequency' class='rs_frequency' name='rs_frequency'> <option value='Daily'>${this.options.texts.daily}</option> <option value='Weekly'>${this.options.texts.weekly}</option> <option value='Monthly'>${this.options.texts.monthly}</option> <option value='Yearly'>${this.options.texts.yearly}</option> </select> </p> <div class='daily_options freq_option_section'> <p> ${this.options.texts.every} <input type='number' data-wrapper-class='ui-recurring-select' name='rs_daily_interval' class='rs_daily_interval rs_interval' value='1' size='2' /> ${this.options.texts.days} </p> </div> <div class='weekly_options freq_option_section'> <p> ${this.options.texts.every} <input type='number' data-wrapper-class='ui-recurring-select' name='rs_weekly_interval' class='rs_weekly_interval rs_interval' value='1' size='2' /> ${this.options.texts.weeks_on}: </p> <div class='day_holder'>`,t=e=i=this.options.texts.first_day_of_week,s=7+this.options.texts.first_day_of_week;i<=s?e<s:e>s;t=i<=s?++e:--e)n+=`<a href='#' data-value='${t%=7}'>${this.options.texts.days_first_letter[t]}</a>`;return n+`</div> <span style='clear:both; visibility:hidden; height:1px;'>.</span> </div> <div class='monthly_options freq_option_section'> <p> ${this.options.texts.every} <input type='number' data-wrapper-class='ui-recurring-select' name='rs_monthly_interval' class='rs_monthly_interval rs_interval' value='1' size='2' /> ${this.options.texts.months}: </p> <p class='monthly_rule_type'> <span><label for='monthly_rule_type_day'>${this.options.texts.day_of_month}</label><input type='radio' class='monthly_rule_type_day' name='monthly_rule_type' id='monthly_rule_type_day' value='true' /></span> <span><label for='monthly_rule_type_week'>${this.options.texts.day_of_week}</label><input type='radio' class='monthly_rule_type_week' name='monthly_rule_type' id='monthly_rule_type_week' value='true' /></span> </p> <p class='rs_calendar_day'></p> <p class='rs_calendar_week'></p> </div> <div class='yearly_options freq_option_section'> <p> ${this.options.texts.every} <input type='number' data-wrapper-class='ui-recurring-select' name='rs_yearly_interval' class='rs_yearly_interval rs_interval' value='1' size='2' /> ${this.options.texts.years} </p> </div> <p class='rs_summary'> <span></span> </p> <div class='controls'> <input type='button' data-wrapper-class='ui-recurring-select' class='rs_save' value='${this.options.texts.ok}' /> <input type='button' data-wrapper-class='ui-recurring-select' class='rs_cancel' value='${this.options.texts.cancel}' /> </div> </div> </div> </div>`}}return e.defaults={debug:!1,name:"recurring_select_dialog",monthly:{show_week:[!0,!0,!0,!0,!1,!1]},texts:{locale_iso_code:"en",repeat:"Repeat",last_day:"Last Day",frequency:"Frequency",daily:"Daily",weekly:"Weekly",monthly:"Monthly",yearly:"Yearly",every:"Every",days:"day(s)",weeks_on:"week(s) on",months:"month(s)",years:"year(s)",day_of_month:"Day of month",day_of_week:"Day of week",cancel:"Cancel",ok:"OK",summary:"Summary",first_day_of_week:0,days_first_letter:["S","M","T","W","T","F","S"],order:["1st","2nd","3rd","4th","5th","Last"],show_week:[!0,!0,!0,!0,!1,!1]}},e}()}).call(this,i(1))},function(t,e,i){"use strict";i.r(e);i(5),i(6);var s=i(2);e.default=s.a},function(t,e,i){},function(t,e,i){}])});